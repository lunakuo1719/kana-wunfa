<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>æ–‡æ³•è¨ä¼åœ˜~æï¼</title>
    <style>
        :root {
            --kanahei-pink: #fce4ec; 
            --kanahei-rose: #f06292; 
            --kanahei-brown: #6d4c41; 
            --kanahei-cream: #fff9c4; 
        }

        * { box-sizing: border-box; font-family: 'Arial', sans-serif; font-weight: 900; -webkit-tap-highlight-color: transparent; }

        body { margin: 0; padding: 10px; background-color: var(--kanahei-pink); display: flex; justify-content: center; align-items: center; min-height: 100vh; }

        .card {
            width: 100%; max-width: 480px; background: white;
            border: 5px solid var(--kanahei-brown);
            border-radius: 40px; padding: 25px;
            box-shadow: 0px 10px 0px var(--kanahei-rose);
            position: relative; text-align: center;
        }

        /* ä¸‰åœ–ä¸¦æ’å®¹å™¨ */
        .header-gifs { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-end; /* è®“åœ–ç‰‡åº•éƒ¨å°é½Š */
            margin-bottom: 15px;
            padding: 0 5px;
        }
        .header-gifs img { width: 30%; height: auto; }
        /* è®“ä¸­é–“é‚£å¼µ GIF ç¨å¾®å¤§ä¸€é» */
        .header-gifs img:nth-child(2) { width: 38%; transform: translateY(-5px); }

        /* ç­”é¡Œå›é¥‹å½ˆå‡ºå±¤ */
        #feedback-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 999; display: none; pointer-events: none;
        }
        #feedback-overlay img { width: 220px; filter: drop-shadow(0 0 15px white); }

        .progress-container { margin: 25px 0; position: relative; height: 60px; }
        .piske-runner { position: absolute; bottom: 15px; width: 65px; transition: left 0.3s; margin-left: -32px; }
        .bar-outer { height: 16px; background: var(--kanahei-cream); border: 3px solid var(--kanahei-brown); border-radius: 10px; overflow: hidden; }
        .bar-inner { height: 100%; width: 0%; background: var(--kanahei-rose); transition: width 0.3s; }

        .q-box { font-size: 24px; color: var(--kanahei-brown); margin: 20px 0; text-align: left; line-height: 1.5; min-height: 60px; }
        
        .btn-choice { 
            background: white; margin-bottom: 15px; font-size: 22px; 
            border: 3px solid var(--kanahei-brown); border-radius: 20px; 
            width: 100%; padding: 20px; text-align: left; cursor: pointer; color: var(--kanahei-brown);
            box-shadow: 0 5px 0 #ddd; transition: 0.1s;
        }
        .btn-choice:active { transform: translateY(3px); box-shadow: none; }

        .main-btn { 
            width: 90%; padding: 18px; font-size: 24px; border-radius: 35px; 
            background: var(--kanahei-rose); color: white; border: 4px solid var(--kanahei-brown); 
            cursor: pointer; box-shadow: 0 6px 0 var(--kanahei-brown); margin: 12px 0;
        }

        .translation-box { 
            background: #fff9c4; padding: 18px; border-radius: 20px; 
            margin-top: 15px; font-size: 19px; border: 3px dashed var(--kanahei-rose); 
            color: #d81b60; text-align: left; animation: fadeIn 0.5s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="feedback-overlay"><img id="feedback-img" src=""></div>

<div class="card">
    <div id="dashboard">
        <div class="header-gifs">
            <img src="https://lunakuo1719.github.io/kana-wunfa/heade-M.gif">
            <img src="https://lunakuo1719.github.io/kana-wunfa/xmas.gif">
            <img src="https://lunakuo1719.github.io/kana-wunfa/heade_r.gif">
        </div>
        <h1 style="color: var(--kanahei-rose); margin:5px 0; font-size: 28px;">æ–‡æ³•è¨ä¼åœ˜~æï¼</h1>
        
        <div style="background: var(--kanahei-cream); padding: 18px; border-radius: 25px; border: 3px solid var(--kanahei-brown); margin: 20px 0;">
            <p style="font-size:20px; margin:8px 0;">å·²ç†Ÿç·´ï¼š<span id="mastered-count" style="color:var(--kanahei-rose)">0</span></p>
            <p style="font-size:20px; margin:8px 0;">é€²åº¦ï¼šLv.<span id="lv-display">1</span> | è²¼ç´™ï¼š<span id="sticker-count">0</span>/17</p>
        </div>

        <button class="main-btn" onclick="startLevel()">é–‹å§‹è¨ä¼ï¼</button>
        <button id="retry-btn" class="main-btn hidden" style="background:#b2cecf;" onclick="startRetry()">éŒ¯é¡Œè£œè€ƒ</button>
        <button class="main-btn" style="background:#ffd54f;" onclick="showBook()">æˆ‘çš„æ”¶é›†å†Š</button>
    </div>

    <div id="game-zone" class="hidden">
        <div class="progress-container">
            <img id="piske-img" src="https://lunakuo1719.github.io/kana-wunfa/glasskar.gif" class="piske-runner">
            <div class="bar-outer"><div class="bar-inner" id="progress-bar"></div></div>
        </div>
        
        <div id="q-text" class="q-box"></div>
        <div id="choices-area"></div>
        
        <div id="hint-area" class="translation-box hidden">
            <strong>ğŸ’¡ ä¸­æ–‡ç¿»è­¯ï¼š</strong><br><span id="hint-text"></span>
        </div>
    </div>
</div>

<script>
// åœ–æª”è¨­å®š
const IMG_YES = "https://lunakuo1719.github.io/kana-wunfa/heartna.gif";
const IMG_WRONG = "https://lunakuo1719.github.io/kana-wunfa/Wrong.gif";

// é€™è£¡æ”¾å…¥å¦³æ•´ç†çš„ 100 é¡Œ
const allQuestions = [
    { q: "This is _______ elephant.", opts: ["a", "an", "the", "X"], a: "an", note: "é€™æ˜¯ä¸€éš»å¤§è±¡ã€‚elephant æ˜¯æ¯éŸ³é–‹é ­ï¼Œæ‰€ä»¥å† è©è¦ç”¨ an å”·ï¼" },
    { q: "I _______ a student.", opts: ["am", "is", "are", "be"], a: "am", note: "æˆ‘æ˜¯ä¸€å€‹å­¸ç”Ÿã€‚ä¸»è©æ˜¯ I çš„æ™‚å€™ï¼ŒBå‹•è©è¦ç”¨ amã€‚" },
    // ... ä¹‹å¾Œè«‹æŠŠå‰©ä¸‹çš„é¡Œç›®è£œåœ¨é€™é‚Š
];

let userData = JSON.parse(localStorage.getItem('kana_v5')) || { mastered: 0, currentLevel: 0, failed_list: [], stickers: [] };
let currentGroup = [];
let totalInGroup = 20;
let isLocked = false;

function init() {
    document.getElementById('mastered-count').innerText = userData.mastered;
    document.getElementById('lv-display').innerText = userData.currentLevel + 1;
    document.getElementById('sticker-count').innerText = userData.stickers.length;
    if (userData.failed_list.length > 0) document.getElementById('retry-btn').classList.remove('hidden');
}

function startLevel() {
    const startIdx = userData.currentLevel * 20;
    const group = allQuestions.slice(startIdx, startIdx + 20);
    if (group.length === 0) return alert("å¤ªå¼·äº†ï¼å…¨éƒ¨é¡Œç›®éƒ½æ”»ç•¥å®Œäº†æï¼");
    currentGroup = group.sort(() => Math.random() - 0.5);
    totalInGroup = currentGroup.length;
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('game-zone').classList.remove('hidden');
    renderQuestion();
}

function renderQuestion() {
    isLocked = false;
    if (currentGroup.length === 0) { alert("æœ¬é—œå®Œæˆï¼"); location.reload(); return; }
    
    const data = currentGroup[0];
    document.getElementById('q-text').innerText = data.q;
    document.getElementById('hint-text').innerText = data.note;
    document.getElementById('hint-area').classList.add('hidden');
    
    const area = document.getElementById('choices-area');
    area.innerHTML = "";
    data.opts.forEach(opt => {
        const b = document.createElement('button');
        b.className = "btn-choice";
        b.innerText = opt;
        b.onclick = () => handleSelect(opt, b);
        area.appendChild(b);
    });

    const solved = totalInGroup - currentGroup.length;
    const p = (solved/totalInGroup)*100;
    document.getElementById('progress-bar').style.width = p + "%";
    document.getElementById('piske-img').style.left = p + "%";
}

function handleSelect(opt, b) {
    if (isLocked) return;
    isLocked = true;
    const cur = currentGroup[0];
    const overlay = document.getElementById('feedback-overlay');
    const fImg = document.getElementById('feedback-img');

    document.getElementById('hint-area').classList.remove('hidden'); // é»æ“Šå¾Œç«‹åˆ»é¡¯ç¤ºç¿»è­¯

    if (opt === cur.a) {
        fImg.src = IMG_YES + "?t=" + Date.now();
        overlay.style.display = "block";
        b.style.background = "#b2cecf"; // ç­”å°è®Šç²‰è—è‰²
        
        setTimeout(() => {
            overlay.style.display = "none";
            currentGroup.shift();
            userData.mastered++;
            saveData();
            renderQuestion();
        }, 1800);
    } else {
        fImg.src = IMG_WRONG + "?t=" + Date.now();
        overlay.style.display = "block";
        b.style.background = "#f06292";
        b.style.color = "white";

        setTimeout(() => {
            overlay.style.display = "none";
            currentGroup.push(currentGroup.shift()); // ä¸Ÿåˆ°æœ€å¾Œä¸€é¡Œ
            renderQuestion();
        }, 2200);
    }
}

function saveData() { localStorage.setItem('kana_v5', JSON.stringify(userData)); }
function showBook() { alert("æ”¶é›†å†Šé–‹ç™¼ä¸­ï¼Œè«‹æœŸå¾…ä¸‹æ¬¡æ›´æ–°æï¼"); } // é€™è£¡å¯æ¥å…¥ä¹‹å‰çš„è²¼ç´™ç°¿ä»£ç¢¼

init();
</script>
</body>
</html>
