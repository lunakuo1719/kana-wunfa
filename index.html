<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>æ–‡æ³•è¨ä¼åœ˜~æï¼</title>
    <style>
        :root {
            --kanahei-pink: #fce4ec; 
            --kanahei-rose: #f06292; 
            --kanahei-brown: #6d4c41; 
            --kanahei-cream: #fff9c4; 
        }

        * { box-sizing: border-box; font-family: 'Arial', sans-serif; font-weight: 900; -webkit-tap-highlight-color: transparent; }

        /* ä¿®æ­£ï¼šå…è¨±æ²å‹•ï¼Œé¿å…æ‰‹æ©Ÿç•«é¢ä¸‹åŠéƒ¨æ¶ˆå¤± */
        body { 
            margin: 0; padding: 15px; background-color: var(--kanahei-pink); 
            display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; overflow-y: auto; 
        }

        .card {
            width: 100%; max-width: 480px; background: white;
            border: 5px solid var(--kanahei-brown);
            border-radius: 40px; padding: 20px;
            box-shadow: 0px 8px 0px var(--kanahei-rose);
            position: relative; text-align: center;
            margin-bottom: 20px; /* ç•™é»ç©ºé–“çµ¦åº•éƒ¨ */
        }

        /* é¦–é ä¸‰åœ– */
        .header-gifs { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; }
        .header-gifs img { width: 30%; height: auto; }
        .header-gifs img:nth-child(2) { width: 36%; transform: translateY(-5px); }

        /* ç­”é¡Œå›é¥‹ GIF */
        #feedback-overlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 999; display: none; pointer-events: none;
        }
        #feedback-overlay img { width: 200px; filter: drop-shadow(0 0 10px white); }

        /* å…¨è¢å¹•é€šé—œå¤§åœ– (LINE è²¼åœ–é¢¨æ ¼) */
        #win-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(255, 255, 255, 0.8);
            display: none; flex-direction: column; justify-content: center;
            align-items: center; z-index: 1000; animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #win-overlay img { width: 85%; max-width: 350px; height: auto; }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

        /* é€²åº¦æ¢ */
        .progress-info { display: flex; justify-content: space-between; font-size: 15px; margin-bottom: 5px; color: var(--kanahei-brown); }
        .progress-container { margin-bottom: 20px; position: relative; height: 50px; }
        .piske-runner { position: absolute; bottom: 10px; width: 55px; transition: left 0.3s; margin-left: -27px; }
        .bar-outer { height: 14px; background: var(--kanahei-cream); border: 3px solid var(--kanahei-brown); border-radius: 10px; overflow: hidden; }
        .bar-inner { height: 100%; width: 0%; background: var(--kanahei-rose); transition: width 0.3s; }

        .q-box { font-size: 22px; color: var(--kanahei-brown); margin: 15px 0; text-align: left; line-height: 1.4; }
        
        .btn-choice { 
            background: white; margin-bottom: 12px; font-size: 20px; 
            border: 3px solid var(--kanahei-brown); border-radius: 18px; 
            width: 100%; padding: 15px; text-align: left; cursor: pointer; color: var(--kanahei-brown);
            box-shadow: 0 4px 0 #ddd;
        }

        .main-btn { 
            width: 90%; padding: 15px; font-size: 22px; border-radius: 30px; 
            background: var(--kanahei-rose); color: white; border: 4px solid var(--kanahei-brown); 
            cursor: pointer; box-shadow: 0 5px 0 var(--kanahei-brown); margin: 8px 0;
        }

        .translation-box { 
            background: #fff9c4; padding: 15px; border-radius: 20px; 
            margin-top: 15px; font-size: 18px; border: 3px dashed var(--kanahei-rose); 
            color: #d81b60; text-align: left;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div id="feedback-overlay"><img id="feedback-img" src=""></div>

<div id="win-overlay" onclick="location.reload()">
    <img src="https://lunakuo1719.github.io/kana-wunfa/nahappy.gif">
    <h1 style="color: var(--kanahei-rose); text-shadow: 2px 2px white;">æ”»ç•¥æˆåŠŸï¼æï¼</h1>
    <p>é»æ“Šç•«é¢å›åˆ°é¦–é </p>
</div>

<div class="card">
    <div id="dashboard">
        <div class="header-gifs">
            <img src="https://lunakuo1719.github.io/kana-wunfa/heade-M.gif">
            <img src="https://lunakuo1719.github.io/kana-wunfa/xmas.gif">
            <img src="https://lunakuo1719.github.io/kana-wunfa/heade_r.gif">
        </div>
        <h1 style="color: var(--kanahei-rose); margin:5px 0; font-size: 26px;">æ–‡æ³•è¨ä¼åœ˜~æï¼</h1>
        
        <div style="background: var(--kanahei-cream); padding: 15px; border-radius: 25px; border: 3px solid var(--kanahei-brown); margin: 15px 0;">
            <p style="font-size:18px; margin:5px 0;">å·²ç†Ÿç·´ï¼š<span id="mastered-count" style="color:var(--kanahei-rose)">0</span></p>
            <p style="font-size:18px; margin:5px 0;">éŒ¯é¡Œæ•¸ï¼š<span id="failed-count">0</span> | è²¼ç´™ï¼š<span id="sticker-count">0</span>/17</p>
        </div>

        <button class="main-btn" onclick="startLevel()">é–‹å§‹è¨ä¼ï¼</button>
        <button id="retry-btn" class="main-btn" style="background:#b2cecf; display:none;" onclick="startRetry()">éŒ¯é¡Œè£œè€ƒ</button>
        <button class="main-btn" style="background:#ffd54f;" onclick="alert('æ”¶é›†å†Šå³å°‡é–‹æ”¾ï¼')">æˆ‘çš„æ”¶é›†å†Š</button>
    </div>

    <div id="game-zone" class="hidden">
        <div class="progress-info">
            <span>è¨ä¼é€²è¡Œä¸­...</span>
            <span><span id="progress-num">0</span> / <span id="total-num">20</span></span>
        </div>
        <div class="progress-container">
            <img id="piske-img" src="https://lunakuo1719.github.io/kana-wunfa/giphy_haha.gif" class="piske-runner">
            <div class="bar-outer"><div class="bar-inner" id="progress-bar"></div></div>
        </div>
        
        <div id="q-text" class="q-box"></div>
        <div id="choices-area"></div>
        
        <div id="hint-area" class="translation-box hidden">
            <strong>ğŸ’¡ ä¸­æ–‡ç¿»è­¯ï¼š</strong><br><span id="hint-text"></span>
        </div>
    </div>
</div>

<script>
const IMG_YES = "https://lunakuo1719.github.io/kana-wunfa/heartna.gif";
const IMG_WRONG = "https://lunakuo1719.github.io/kana-wunfa/Wrong.gif";

const allQuestions = [
    { q: "This is _______ elephant.", opts: ["a", "an", "X", "the"], a: "an", note: "ä¸­æ–‡ç¿»è­¯ï¼šé€™æ˜¯ä¸€éš»å¤§è±¡ã€‚" },
    { q: "I _______ a teacher.", opts: ["am", "is", "were", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æ˜¯ä¸€ä½è€å¸«ã€‚" },
    { q: "His sons _______ good boys.", opts: ["is", "are", "do", "have"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–çš„å…’å­å€‘æ˜¯å¥½ç”·å­©ã€‚" },
    { q: "They _______ cats.", opts: ["is am", "are", "be", "X"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šç‰ å€‘æ˜¯è²“ã€‚" },
    { q: "The moon _______ yellow.", opts: ["was", "were", "is", "am"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šæœˆäº®æ˜¯é»ƒè‰²çš„ã€‚" },
    { q: "They _______ students.", opts: ["is", "are", "be", "am"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘æ˜¯å­¸ç”Ÿã€‚" },
    { q: "She _______ a doctor.", opts: ["do", "does", "are", "is"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šå¥¹æ˜¯ä¸€ä½é†«ç”Ÿã€‚" },
    { q: "He _______ many books.", opts: ["is", "be", "have", "has"], a: "has", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æœ‰å¾ˆå¤šæ›¸ã€‚" },
    { q: "We _______ many pens.", opts: ["is", "be", "have", "has"], a: "have", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘æœ‰å¾ˆå¤šç­†ã€‚" },
    { q: "A teacher works in a _______.", opts: ["school", "ship", "car", "train"], a: "school", note: "ä¸­æ–‡ç¿»è­¯ï¼šè€å¸«åœ¨å­¸æ ¡è£¡å·¥ä½œã€‚" },
    { q: "They have _______ dogs.", opts: ["twelve", "a", "one", "an"], a: "twelve", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘æœ‰12éš»ç‹—ã€‚" },
    { q: "We like _______ daughters.", opts: ["our", "yours", "us", "you"], a: "our", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘å–œæ­¡æˆ‘å€‘çš„å¥³å…’å€‘ã€‚" },
    { q: "_______ house is beautiful.", opts: ["I", "My", "Me", "Mine"], a: "My", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘çš„æˆ¿å­æ˜¯æ¼‚äº®çš„ã€‚" },
    { q: "Banana is _______.", opts: ["red", "brown", "yellow", "blue"], a: "yellow", note: "ä¸­æ–‡ç¿»è­¯ï¼šé¦™è•‰æ˜¯é»ƒè‰²çš„ã€‚" },
    { q: "Trees are _______.", opts: ["pink", "red", "black", "green"], a: "green", note: "ä¸­æ–‡ç¿»è­¯ï¼šæ¨¹æ˜¯ç¶ è‰²çš„ã€‚" },
    { q: "I am _______ teacher.", opts: ["he", "me", "they", "his"], a: "his", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æ˜¯ä»–çš„è€å¸«ã€‚" },
    { q: "He is _______ teacher.", opts: ["mine", "my", "yours", "hers"], a: "my", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ˜¯æˆ‘çš„è€å¸«ã€‚" },
    { q: "We are talking _______ the book.", opts: ["in", "about", "on", "under"], a: "about", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘æ­£åœ¨èªªé‚£æœ¬æ›¸ã€‚" },
    { q: "_______ can fly.", opts: ["Dogs", "Cats", "Birds", "Fish"], a: "Birds", note: "ä¸­æ–‡ç¿»è­¯ï¼šé³¥æœƒé£›ã€‚" },
    { q: "I drank _______ for breakfast.", opts: ["milk", "books", "theaters", "rabbits"], a: "milk", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å–ç‰›å¥¶ç•¶æ—©é¤ã€‚" },
    { q: "I have two _______.", opts: ["eyes", "nose", "mouth", "face"], a: "eyes", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æœ‰å…©éš»çœ¼ç›ã€‚" },
    { q: "He _______ three sisters.", opts: ["is", "are", "has", "have"], a: "has", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æœ‰ä¸‰å€‹å§å¦¹ã€‚" },
    { q: "They _______ three brothers.", opts: ["is", "are", "has", "have"], a: "have", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘æœ‰ä¸‰å€‹å…„å¼Ÿã€‚" },
    { q: "My father _______ a car.", opts: ["has", "have", "is", "are"], a: "has", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘çˆ¶è¦ªæœ‰ä¸€è¼›è»Šã€‚" },
    { q: "The boy _______ a kite.", opts: ["has", "have", "is", "are"], a: "has", note: "ä¸­æ–‡ç¿»è­¯ï¼šç”·å­©æœ‰ä¸€éš»é¢¨ç®ã€‚" },
    { q: "The boys _______ a kite.", opts: ["has", "have", "is", "are"], a: "have", note: "ä¸­æ–‡ç¿»è­¯ï¼šç”·å­©å€‘æœ‰ä¸€éš»é¢¨ç®ã€‚" },
    { q: "A bird _______ two wings.", opts: ["has", "have", "is", "are"], a: "has", note: "ä¸­æ–‡ç¿»è­¯ï¼šä¸€éš»é³¥æœ‰å…©éš»ç¿…è†€ã€‚" },
    { q: "Birds _______ wings.", opts: ["has", "have", "is", "are"], a: "have", note: "ä¸­æ–‡ç¿»è­¯ï¼šé³¥æœ‰ç¿…è†€ã€‚" },
    { q: "He _______ my friend.", opts: ["is", "are", "am", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ˜¯æˆ‘çš„æœ‹å‹ã€‚" },
    { q: "We _______ friends.", opts: ["is", "are", "am", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘æ˜¯æœ‹å‹ã€‚" },
    { q: "I _______ hungry.", opts: ["is", "are", "am", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘é¤“äº†ã€‚" },
    { q: "The cats _______ hungry.", opts: ["is", "are", "am", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šè²“é¤“äº†ã€‚" },
    { q: "He _______ go to school.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "doesn't", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–ä¸ä¸Šå­¸ã€‚" },
    { q: "They _______ go to school.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "don't", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘ä¸ä¸Šå­¸ã€‚" },
    { q: "He _______ like to play tennis.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "doesn't", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–ä¸å–œæ­¡æ‰“ç¶²çƒã€‚" },
    { q: "I _______ like to play tennis.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "don't", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘ä¸å–œæ­¡æ‰“ç¶²çƒã€‚" },
    { q: "We _______ like to play tennis.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "don't", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘ä¸å–œæ­¡æ‰“ç¶²çƒã€‚" },
    { q: "The boy _______ like to play tennis.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "doesn't", note: "ä¸­æ–‡ç¿»è­¯ï¼šé‚£å€‹ç”·å­©ä¸å–œæ­¡æ‰“ç¶²çƒã€‚" },
    { q: "The boys _______ like to play tennis.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "don't", note: "ä¸­æ–‡ç¿»è­¯ï¼šé‚£äº›ç”·å­©ä¸å–œæ­¡æ‰“ç¶²çƒã€‚" },
    { q: "It _______ rain in winter.", opts: ["don't", "doesn't", "isn't", "aren't"], a: "doesn't", note: "ä¸­æ–‡ç¿»è­¯ï¼šå†¬å¤©ä¸ä¸‹é›¨ã€‚" },
    { q: "He _______ very tall.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆé«˜ã€‚" },
    { q: "They _______ very tall.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆé«˜ã€‚" },
    { q: "I _______ a tall boy.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æ˜¯ä¸€å€‹é«˜å€‹å­çš„ç”·å­©ã€‚" },
    { q: "He _______ a tall boy.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ˜¯ä¸€å€‹é«˜å€‹å­çš„ç”·å­©ã€‚" },
    { q: "I _______ hot.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å¾ˆç†±ã€‚" },
    { q: "He _______ hot.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆç†±ã€‚" },
    { q: "They _______ hot.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆç†±ã€‚" },
    { q: "I _______ thirsty.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æ¸´äº†ã€‚" },
    { q: "He _______ thirsty.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ¸´äº†ã€‚" },
    { q: "They _______ thirsty.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘æ¸´äº†ã€‚" },
    { q: "We _______ thirsty.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å€‘æ¸´äº†ã€‚" },
    { q: "It _______ hot today.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»Šå¤©å¤©æ°£ç†±ã€‚" },
    { q: "It _______ cold today.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»Šå¤©å¤©æ°£å†·ã€‚" },
    { q: "The water _______ cold.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šæ°´æ˜¯å†·çš„ã€‚" },
    { q: "The flowers _______ beautiful.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šèŠ±æ˜¯æ¼‚äº®çš„ã€‚" },
    { q: "The book _______ new.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šé€™æœ¬æ›¸æ˜¯æ–°çš„ã€‚" },
    { q: "The books _______ new.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šé€™äº›æ›¸æ˜¯æ–°çš„ã€‚" },
    { q: "He _______ my brother.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ˜¯æˆ‘çš„å…„å¼Ÿã€‚" },
    { q: "They _______ my brothers.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘æ˜¯æˆ‘çš„å…„å¼Ÿã€‚" },
    { q: "She _______ my sister.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šå¥¹æ˜¯æˆ‘çš„å§å¦¹ã€‚" },
    { q: "They _______ my sisters.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šå¥¹å€‘æ˜¯æˆ‘çš„å§å¦¹ã€‚" },
    { q: "I _______ happy.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å¾ˆå¿«æ¨‚ã€‚" },
    { q: "He _______ happy.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆå¿«æ¨‚ã€‚" },
    { q: "They _______ happy.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆå¿«æ¨‚ã€‚" },
    { q: "I _______ sad.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å¾ˆæ†‚å‚·ã€‚" },
    { q: "He _______ sad.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆæ†‚å‚·ã€‚" },
    { q: "They _______ sad.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆæ†‚å‚·ã€‚" },
    { q: "I _______ thin.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å¾ˆç˜¦ã€‚" },
    { q: "He _______ thin.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆç˜¦ã€‚" },
    { q: "They _______ thin.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆç˜¦ã€‚" },
    { q: "I _______ fat.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘å¾ˆèƒ–ã€‚" },
    { q: "He _______ fat.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å¾ˆèƒ–ã€‚" },
    { q: "They _______ fat.", opts: ["am", "is", "are", "be"], a: "are", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–å€‘å¾ˆèƒ–ã€‚" },
    { q: "I _______ a student.", opts: ["am", "is", "are", "be"], a: "am", note: "ä¸­æ–‡ç¿»è­¯ï¼šæˆ‘æ˜¯ä¸€å€‹å­¸ç”Ÿã€‚" },
    { q: "He _______ a student.", opts: ["am", "is", "are", "be"], a: "is", note: "ä¸­æ–‡ç¿»è­¯ï¼šä»–æ˜¯ä¸€å€‹å­¸ç”Ÿã€‚" },
    { q: "Choose the correct sentence:", opts: ["I like to play the piano.", "I like play the piano.", "I am like to play the piano.", "I like playing the piano."], a: "I like to play the piano.", note: "1-1ï¼šlike å¾Œæ¥ to V æˆ– Ving [cite: 2, 38]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He swim every day.", "He swims every day.", "He is swim every day.", "He swimming every day."], a: "He swims every day.", note: "1-2ï¼šç¬¬ä¸‰äººç¨±å–®æ•¸ç¿’æ…£æ€§å‹•ä½œï¼Œå‹•è©åŠ  s [cite: 2, 42]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I not his student.", "I am not his student.", "I don't his student.", "I no be his student."], a: "I am not his student.", note: "1-3ï¼šB å‹•è©å¦å®šå¥çµæ§‹ [cite: 2, 45]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["My father likes to play the violin.", "My father likes to playing violin.", "My father like to play the violin.", "My father is likes to play the violin."], a: "My father likes to play the violin.", note: "1-4ï¼šä¸å®šè© to ä¹‹å¾Œæ¥åŸå½¢å‹•è© [cite: 2, 47]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He can swims.", "He can swim.", "He can to swim.", "He is can swim."], a: "He can swim.", note: "1-5ï¼šåŠ©å‹•è© can å¾Œæ¥åŸå½¢å‹•è© [cite: 2, 51]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He hates eat fish.", "He hates to eat fish.", "He hate eat fish.", "He is hate to eat fish."], a: "He hates to eat fish.", note: "1-6ï¼šhate å¾Œæ¥ä¸å®šè© [cite: 2, 54]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["My father go to church every Sunday.", "My father goes to church every Sunday.", "My father is go to church every Sunday.", "My father going to church every Sunday."], a: "My father goes to church every Sunday.", note: "1-7ï¼šè¦å¾‹ç¿’æ…£ç”¨ç¾åœ¨ç°¡å–®å¼ï¼Œå–®æ•¸åŠ  s [cite: 2, 57]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He does not love music.", "He do not live music.", "He is not love music.", "He not loves music."], a: "He does not love music.", note: "1-8ï¼šä¸€èˆ¬å‹•è©å¦å®šéœ€ç”¨åŠ©å‹•è© does [cite: 2, 59]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He walks to work every day.", "He walks to works every day.", "He walk to work every day.", "He is walk to work every day."], a: "He walks to work every day.", note: "1-9ï¼šå–®æ•¸ä¸»è©å‹•è©è®ŠåŒ–åŠå›ºå®šç‰‡èª walk to work [cite: 2, 62]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["Can he to swim?", "Can he swim?", "Does he can swim?", "Can he swims?"], a: "Can he swim.", note: "1-10ï¼šåŠ©å‹•è©å•å¥çµæ§‹ [cite: 2, 66]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I am walking to school every day.", "I walk to school every day.", "I walks to school every day.", "I am walk to school every day."], a: "I walk to school every day.", note: "1-11ï¼šç¿’æ…£æ€§å‹•ä½œä¸ä½¿ç”¨é€²è¡Œå¼ [cite: 3, 69]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I watch TV now.", "I am watching TV now.", "I watching TV now.", "I am watch TV now."], a: "I am watching TV now.", note: "1-12ï¼šnow æç¤ºç¾åœ¨é€²è¡Œå¼ [cite: 3, 72]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He calls his father every day.", "He is calling his father every day.", "He call his father every day.", "He calling his father every day."], a: "He calls his father every day.", note: "1-13ï¼šæ¯æ—¥ç¿’æ…£ç”¨ç¾åœ¨ç°¡å–®å¼ [cite: 3, 74]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He is taking a walk in the morning every day.", "He takes a walk in the morning every day.", "He take a walk in the morning every day.", "He is take a walk every day."], a: "He takes a walk in the morning every day.", note: "1-14ï¼šè¦å¾‹æ™¨é–“æ•£æ­¥ç”¨ç°¡å–®å¼ [cite: 3, 78]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He is playing the piano now.", "He plays the piano now.", "He playing the piano now.", "He is play the piano now."], a: "He is playing the piano now.", note: "1-15ï¼šæ­£åœ¨å½ˆé‹¼ç´ [cite: 3, 80]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He is reading a book now.", "He reads a book now.", "He reading a book now.", "He is read a book now."], a: "He is reading a book now.", note: "1-16ï¼šæ­£åœ¨é–±è®€ [cite: 3, 83]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He swims every morning.", "He is swimming every morning.", "He swim every morning.", "He swimming every morning."], a: "He swims every morning.", note: "1-17ï¼šç¿’æ…£æ€§æ™¨æ³³ [cite: 3, 86]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He is writing a letter at present.", "He writing a letter at present.", "He writes a letter at present.", "He is write a letter at present."], a: "He is writing a letter at present.", note: "1-18ï¼šat present ç”¨é€²è¡Œå¼ [cite: 3, 89]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He talks to his mother now.", "He is talking to his mother now.", "He talking to his mother now.", "He talk to his mother now."], a: "He is talking to his mother now.", note: "1-19ï¼šå¼·èª¿ã€Œç¾åœ¨ã€æ­£åœ¨é€šè©± [cite: 3, 93]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I am swim every day.", "I swim every day.", "I swimming every day.", "I am swimming every day."], a: "I swim every day.", note: "1-20ï¼šI æ­é…åŸå½¢å‹•è©è¡¨ç¤ºç¿’æ…£ [cite: 3, 96]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I walked to school when I was a kid.", "I walk to school when I was a kid.", "I was walk to school when I was a kid.", "I had walk to school when I was a kid."], a: "I walked to school when I was a kid.", note: "1-21ï¼šéå»ç™¼ç”Ÿçš„ç¿’æ…£ï¼Œå‹•è©ç”¨éå»å¼ [cite: 4, 98]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I eat two eggs in the morning today.", "I ate two eggs in the morning today.", "I am eat two eggs in the morning today.", "I eaten two eggs in the morning today."], a: "I ate two eggs in the morning today.", note: "1-22ï¼šå·²å®Œæˆçš„å‹•ä½œï¼ˆåƒéäº†ï¼‰ç”¨éå»å¼ [cite: 4, 102]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I do not like music when I was young.", "I did not like music when I was young.", "I am not like music when I was young.", "I not liked music when I was young."], a: "I did not like music when I was young.", note: "1-23ï¼šéå»çš„å¦å®šç”¨ did not [cite: 4, 105]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I do not go home yesterday.", "I did not go home yesterday.", "I am not go home yesterday.", "I was not go home yesterday."], a: "I did not go home yesterday.", note: "1-24ï¼šæ˜¨å¤©æ²’å›å®¶ï¼Œç”¨ did not + åŸå½¢ [cite: 4, 108]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He is already very good in playing piano when he was six.", "He was already very good at playing piano when he was six.", "He is already very good at playing piano when he was six.", "He was already very good in playing piano when he was six."], a: "He was already very good at playing piano when he was six.", note: "1-25ï¼šbe good at ç‚ºå›ºå®šç”¨æ³•ï¼Œä¸”æ™‚æ…‹é ˆä¸€è‡´ [cite: 4, 111]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["They were my students five years ago.", "They are my students five years ago.", "They been my students five years ago.", "They was my students five years ago."], a: "They were my students five years ago.", note: "1-26ï¼šè¤‡æ•¸éå»å¼ B å‹•è©ç”¨ were [cite: 4, 113]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["Did you go to the church last Sunday?", "Do you go the church last Sunday?", "Are you go to the church last Sunday?", "Were you go to the church last Sunday?"], a: "Did you go to the church last Sunday?", note: "1-27ï¼šéå»æ™‚é–“çš„å•å¥ç”¨ Did [cite: 4, 116]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I am very sad when I heard the bad news yesterday.", "I was very sad when I heard the bad news yesterday.", "I very sad when I heard the bad news yesterday.", "I am been very sad when I heard the news yesterday."], a: "I was very sad when I heard the bad news yesterday.", note: "1-28ï¼šç•¶æ™‚æ„Ÿåˆ°æ‚²å‚·ï¼Œæ™‚æ…‹éœ€å‰å¾Œä¸€è‡´ [cite: 4, 119]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["He does not know how to swim when he was a kid.", "He did not know how to swim when he was a kid.", "He not know how to swim when he was a kid.", "He is not know how to swim when he was a kid."], a: "He did not know how to swim when he was a kid.", note: "1-29ï¼šæè¿°å°æ™‚å€™ä¸å…·å‚™çš„èƒ½åŠ›ç”¨ past tense [cite: 4, 123]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["The earth goes around the sun.", "The earth went around the sun.", "The earth is go around the sun.", "The earth going around the sun."], a: "The earth goes around the sun.", note: "1-30ï¼šçœŸç†ã€äº‹å¯¦æ†ç”¨ç¾åœ¨ç°¡å–®å¼ [cite: 4, 125]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["When you came to my house, I am calling my father.", "When you came to my house, I was calling my father.", "When you come to my house, I was calling my father.", "When you came to my house, I called my father."], a: "When you came to my house, I was calling my father.", note: "1-31ï¼šéå»æŸå‹•ä½œç™¼ç”Ÿæ™‚ï¼Œå¦ä¸€å‹•ä½œæ­£åœ¨é€²è¡Œ [cite: 5, 129]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["I could not answer you because I am taking a shower.", "I could not answer you because I was taking a shower.", "I cannot answer you because I was taking a shower.", "I could not answer you because I taken a shower."], a: "I could not answer you because I was taking a shower.", note: "1-32ï¼šæè¿°ç•¶æ™‚æ­£åœ¨æ´—æ¾¡ï¼Œæ‰€ä»¥æ²’æ¥é›»è©± [cite: 5, 134]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["When the train reached the station, people are dancing there.", "When the train reached the station, people were dancing there.", "When the train reach the station, people were dancing there.", "When the train reached the station, people danced there."], a: "When the train reached the station, people were dancing there.", note: "1-33ï¼šéå»é€²è¡Œä¸­çš„èƒŒæ™¯å‹•ä½œ [cite: 5, 137]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["When you called me last night, I watched TV.", "When you called me last night, I was watching TV.", "When you call me last night, I am watching TV.", "When you called me last night, I watching TV."], a: "When you called me last night, I was watching TV.", note: "1-34ï¼šå¼·èª¿ç•¶æ™‚ã€Œæ­£åœ¨çœ‹é›»è¦–ã€ [cite: 5, 141]ã€‚" },
    { q: "Choose the correct sentence:", opts: ["My mother always cooked when I went home.", "My mother was always cooking when I went home.", "My mother always cook when I went home.", "My mother is always cooking when I went home."], a: "My mother was always cooking when I went home.", note: "1-35ï¼šéå»ç¿’æ…£æ€§æ­£åœ¨ç™¼ç”Ÿçš„å‹•ä½œ [cite: 5, 143]ã€‚" },
];

let userData = JSON.parse(localStorage.getItem('kana_v7')) || { mastered: 0, currentLevel: 0, failed_list: [], stickers: [] };
let currentGroup = [];
let totalInGroup = 20;
let isLocked = false;
let isRetryMode = false;

function init() {
    document.getElementById('mastered-count').innerText = userData.mastered;
    document.getElementById('failed-count').innerText = userData.failed_list.length;
    document.getElementById('sticker-count').innerText = userData.stickers.length;
    // å¼·åˆ¶æª¢æŸ¥è£œè€ƒæŒ‰éˆ•
    const btn = document.getElementById('retry-btn');
    if (userData.failed_list && userData.failed_list.length > 0) {
        btn.style.display = "inline-block";
    } else {
        btn.style.display = "none";
    }
}

function startLevel() {
    isRetryMode = false;
    const startIdx = (userData.currentLevel % 5) * 20;
    currentGroup = allQuestions.slice(startIdx, startIdx + 20).sort(() => Math.random() - 0.5);
    setupGame();
}

function startRetry() {
    isRetryMode = true;
    currentGroup = [...userData.failed_list].sort(() => Math.random() - 0.5);
    setupGame();
}

function setupGame() {
    totalInGroup = currentGroup.length;
    document.getElementById('total-num').innerText = totalInGroup;
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('game-zone').classList.remove('hidden');
    renderQuestion();
}

function renderQuestion() {
    isLocked = false;
    if (currentGroup.length === 0) return finishLevel();
    
    const data = currentGroup[0];
    document.getElementById('q-text').innerText = data.q;
    document.getElementById('hint-text').innerText = data.note;
    document.getElementById('hint-area').classList.add('hidden');
    
    const area = document.getElementById('choices-area');
    area.innerHTML = "";
    data.opts.forEach(opt => {
        const b = document.createElement('button');
        b.className = "btn-choice";
        b.innerText = opt;
        b.onclick = () => handleSelect(opt, b);
        area.appendChild(b);
    });

    const solved = totalInGroup - currentGroup.length;
    document.getElementById('progress-num').innerText = solved;
    const p = (solved/totalInGroup)*100;
    document.getElementById('progress-bar').style.width = p + "%";
    document.getElementById('piske-img').style.left = p + "%";
}

function handleSelect(opt, b) {
    if (isLocked) return;
    isLocked = true;
    const cur = currentGroup[0];
    
    document.getElementById('hint-area').classList.remove('hidden');

    if (opt === cur.a) {
        document.getElementById('feedback-img').src = IMG_YES + "?t=" + Date.now();
        document.getElementById('feedback-overlay').style.display = "block";
        b.style.background = "#b2cecf";
        
        if (isRetryMode) {
            userData.failed_list = userData.failed_list.filter(item => item.q !== cur.q);
        } else {
            userData.mastered++;
        }

        setTimeout(() => {
            document.getElementById('feedback-overlay').style.display = "none";
            currentGroup.shift();
            saveData();
            renderQuestion();
        }, 1500);
    } else {
        document.getElementById('feedback-img').src = IMG_WRONG + "?t=" + Date.now();
        document.getElementById('feedback-overlay').style.display = "block";
        b.style.background = "#f06292"; b.style.color = "white";

        if (!isRetryMode && !userData.failed_list.some(item => item.q === cur.q)) {
            userData.failed_list.push(cur);
        }

        setTimeout(() => {
            document.getElementById('feedback-overlay').style.display = "none";
            currentGroup.push(currentGroup.shift());
            renderQuestion();
        }, 1500);
    }
}

function finishLevel() {
    // é¡¯ç¤ºå…¨è¢å¹•é€šé—œå¤§åœ–
    document.getElementById('win-overlay').style.display = "flex";
    if (!isRetryMode) userData.currentLevel++;
    saveData();
}

function saveData() { 
    localStorage.setItem('kana_v7', JSON.stringify(userData)); 
}

init();
</script>
</body>
</html>

